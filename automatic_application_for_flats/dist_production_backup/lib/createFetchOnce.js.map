{"version":3,"sources":["../../src/lib/createFetchOnce.js"],"names":["createFetchOnce","flatOffersUrl","parseFlatOffer","navigateToNextPage","FlatOfferListPage","fetchOnce","getBrowser","page","onFlatOffer","shouldStop","flatOfferListPage","hasNavigatedToNextPage","totalNumberOfFlatOfferElements","numberOfResults","getNumberOfResults","flatOfferElements","getFlatOfferElements","length","flatOfferElement","url","getUrl","process","env","NODE_ENV","flatOffer","then","console","error","Error"],"mappings":";;;;;;;AAAA;;AACA;;AAEO,SAASA,eAAT,CAA0B;AAC/BC,EAAAA,aAD+B;AAE/BC,EAAAA,cAF+B;AAG/BC,EAAAA,kBAH+B;AAI/BC,EAAAA;AAJ+B,CAA1B,EAKJ;AACD,SAAO,eAAeC,SAAf,CACLC,UADK,EAELC,IAFK,EAGLC,WAHK,EAILC,UAAU,GAAG,MAAM,KAJd,EAKL;AACA,UAAMC,iBAAiB,GAAG,IAAIN,iBAAJ,CAAsBG,IAAtB,CAA1B;AACA,UAAM,8DAA4BA,IAA5B,EAAkCN,aAAlC,CAAN;AACA,QAAIU,sBAAJ;AACA,QAAIC,8BAA8B,GAAG,CAArC;AACA,UAAMC,eAAe,GAAG,MAAMH,iBAAiB,CAACI,kBAAlB,EAA9B;;AACA,OAAG;AACD,YAAMC,iBAAiB,GAAG,MAAML,iBAAiB,CAACM,oBAAlB,EAAhC;AACAJ,MAAAA,8BAA8B,IAAIG,iBAAiB,CAACE,MAApD;;AACA,WAAK,MAAMC,gBAAX,IAA+BH,iBAA/B,EAAkD;AAChD,YAAIN,UAAU,EAAd,EAAkB;AAChB;AACD;;AACD,cAAMU,GAAG,GAAG,MAAMD,gBAAgB,CAACE,MAAjB,EAAlB;;AACA,YAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,SAAzB,IAAsC,EAAC,MAAM,4CAAoBJ,GAApB,CAAP,CAA1C,EAA2E;AACzE,gBAAMK,SAAS,GAAG,MAAMtB,cAAc,CAACI,UAAD,EAAaY,gBAAb,CAAtC;AACAV,UAAAA,WAAW,CAACgB,SAAD,CAAX,CAAuBC,IAAvB,CAA4B,YAAY;AACtC,gBAAIJ,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,SAA7B,EAAwC;AACtC,oBAAM,mDAA2BJ,GAA3B,EAAgCK,SAAhC,CAAN;AACD;AACF,WAJD;AAKD;AACF;;AACDb,MAAAA,sBAAsB,GAAG,MAAMR,kBAAkB,CAACI,IAAD,CAAjD;AACD,KAlBD,QAkBSI,sBAlBT;;AAmBA,QAAIC,8BAA8B,KAAKC,eAAvC,EAAwD;AACtDa,MAAAA,OAAO,CAACC,KAAR,CACE,IAAIC,KAAJ,CACG,eAAchB,8BAA+B,aAA9C,GACC,uCAAsCC,eAAgB,GADvD,GAEC,OAAMZ,aAAc,IAHvB,CADF;AAOD;AACF,GAvCD;AAwCD","sourcesContent":["import { hasFetchedFlatOffer, registerFlatOfferAsFetched } from '../fetchedFlatOffers.js'\nimport { navigateToFlatOfferListPage } from './navigateToFlatOfferListPage.js'\n\nexport function createFetchOnce ({\n  flatOffersUrl,\n  parseFlatOffer,\n  navigateToNextPage,\n  FlatOfferListPage,\n}) {\n  return async function fetchOnce (\n    getBrowser,\n    page,\n    onFlatOffer,\n    shouldStop = () => false,\n  ) {\n    const flatOfferListPage = new FlatOfferListPage(page)\n    await navigateToFlatOfferListPage(page, flatOffersUrl)\n    let hasNavigatedToNextPage\n    let totalNumberOfFlatOfferElements = 0\n    const numberOfResults = await flatOfferListPage.getNumberOfResults()\n    do {\n      const flatOfferElements = await flatOfferListPage.getFlatOfferElements()\n      totalNumberOfFlatOfferElements += flatOfferElements.length\n      for (const flatOfferElement of flatOfferElements) {\n        if (shouldStop()) {\n          return\n        }\n        const url = await flatOfferElement.getUrl()\n        if (process.env.NODE_ENV === 'TESTING' || !await hasFetchedFlatOffer(url)) {\n          const flatOffer = await parseFlatOffer(getBrowser, flatOfferElement)\n          onFlatOffer(flatOffer).then(async () => {\n            if (process.env.NODE_ENV !== 'TESTING') {\n              await registerFlatOfferAsFetched(url, flatOffer)\n            }\n          })\n        }\n      }\n      hasNavigatedToNextPage = await navigateToNextPage(page)\n    } while (hasNavigatedToNextPage)\n    if (totalNumberOfFlatOfferElements !== numberOfResults) {\n      console.error(\n        new Error(\n          `Has fetched ${totalNumberOfFlatOfferElements} elements, ` +\n          `but number as results was stated as ${numberOfResults} ` +\n          `(on ${flatOffersUrl}).`,\n        ),\n      )\n    }\n  }\n}\n"],"file":"createFetchOnce.js"}